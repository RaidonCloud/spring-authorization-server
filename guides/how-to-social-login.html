<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How-to: Authenticate using Social Login :: Spring Authorization Server</title>
    <link rel="prev" href="how-to-pkce.html">
    <link rel="next" href="how-to-userinfo.html">
    <meta name="generator" content="Antora 3.2.0-alpha.2">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/css/vendor/search.css">
    <link rel="stylesheet" href="../_/css/vendor/asciidoctor-tabs.css">

    <meta name="version" content="1.2.0">
    <meta name="component" content="authorization-server">
    <link rel="icon" href="../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://spring.io">
        <img
          id="springlogo"
          class="block"
          src="../_/img/spring-logo.svg"
          alt="Spring"
        />
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Why Spring</a>
          <div class="navbar-dropdown">
            <a
              class="navbar-item"
              href="https://spring.io/why-spring"
            >Overview</a>
            <a
              class="navbar-item"
              href="https://spring.io/microservices"
            >Microservices</a>
            <a
              class="navbar-item"
              href="https://spring.io/reactive"
            >Reactive</a>
            <a class="navbar-item" href="https://spring.io/event-driven">Event
              Driven</a>
            <a class="navbar-item" href="https://spring.io/cloud">Cloud</a>
            <a class="navbar-item" href="https://spring.io/web-applications">Web
              Applications</a>
            <a
              class="navbar-item"
              href="https://spring.io/serverless"
            >Serverless</a>
            <a class="navbar-item" href="https://spring.io/batch">Batch</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Learn</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://spring.io/learn">Overview</a>
            <a
              class="navbar-item"
              href="https://spring.io/quickstart"
            >Quickstart</a>
            <a class="navbar-item" href="https://spring.io/guides">Guides</a>
            <a class="navbar-item" href="https://spring.io/blog">Blog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Projects</a>
          <div class="navbar-dropdown" style="min-width: 280px">
            <a
              class="navbar-item"
              href="https://spring.io/projects"
            >Overview</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-boot"
            >Spring Boot</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-framework"
            >Spring Framework</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-cloud"
            >Spring Cloud</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-cloud-dataflow"
            >Spring Cloud Data Flow</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-data"
            >Spring Data</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-integration"
            >Spring Integration</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-batch"
            >Spring Batch</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-security"
            >Spring Security</a>
            <a
              class="navbar-item navbar-item-special"
              href="https://spring.io/projects"
            >View all projects</a>
            <a class="navbar-item" href="https://spring.io/tools">Spring Tools 4</a>
            <a
              class="navbar-item navbar-item-special-2"
              href="https://start.spring.io"
            >Spring Initializr
              <svg
                class="external-link-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 16 16"
              ><polyline
                  points="15 10.94 15 15 1 15 1 1 5.06 1"
                  fill="none"
                  stroke="currentColor"
                  stroke-miterlimit="10"
                  stroke-width="2"
                ></polyline><polyline
                  points="8.93 1 15 1 15 7.07"
                  fill="none"
                  stroke="currentColor"
                  stroke-miterlimit="10"
                  stroke-width="2"
                ></polyline><line
                  x1="15"
                  y1="1"
                  x2="8"
                  y2="8"
                  fill="none"
                  stroke="currentColor"
                  stroke-miterlimit="10"
                  stroke-width="2"
                ></line></svg></a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Academy</a>
          <div class="navbar-dropdown">
            <a
              class="navbar-item"
              href="https://spring.academy/courses"
            >Courses</a>
            <a
              class="navbar-item"
              href="https://spring.academy/learning-path"
            >Get Certified</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://spring.io/support">Overview</a>
            <a class="navbar-item" href="https://spring.io/security">Security
              Advisories</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable is-community">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a
              class="navbar-item"
              href="https://spring.io/community"
            >Overview</a>
            <a class="navbar-item" href="https://spring.io/events">Events</a>
            <a class="navbar-item" href="https://spring.io/team">Team</a>
          </div>
        </div>
      </div>
    </div>
    <label class="theme-toggler">
      <input
        type="checkbox"
        type="checkbox"
        id="switch-theme-checkbox"
        name="switch-theme-checkbox"
      />
      <span class="icon"><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="moon"
          class="svg-inline--fa fa-moon moon"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 384 512"
        ><path
            fill="currentColor"
            d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"
          ></path>
        </svg>
        <svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="sun"
          class="svg-inline--fa fa-sun sun"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        ><path
            fill="currentColor"
            d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"
          ></path>
        </svg></span>
      <span class="text">light</span>
    </label>
  </nav>
</header>
<script>
!function (theme) {
  if (theme === 'dark') {
    document.getElementById('switch-theme-checkbox').parentElement.classList.add('active')
  }
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
</script><div class="body">
<div class="nav-container" data-component="authorization-server" data-version="1.2.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">Spring Authorization Server</span>
  <span class="version">1.2.0-SNAPSHOT</span>
</div><div class="search">
  <button class="DocSearch-Button search-button">
    <svg enable-background="new 0 0 32 32" id="Glyph" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <path d="M27.414,24.586l-5.077-5.077C23.386,17.928,24,16.035,24,14c0-5.514-4.486-10-10-10S4,8.486,4,14  s4.486,10,10,10c2.035,0,3.928-0.614,5.509-1.663l5.077,5.077c0.78,0.781,2.048,0.781,2.828,0  C28.195,26.633,28.195,25.367,27.414,24.586z M7,14c0-3.86,3.14-7,7-7s7,3.14,7,7s-3.14,7-7,7S7,17.86,7,14z" id="XMLID_223_"/>
    </svg>
    Search
    <span class="search-key"></span>
  </button>
</div>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-help.html">Getting Help</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../configuration-model.html">Configuration Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../core-model-components.html">Core Model / Components</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../protocol-endpoints.html">Protocol Endpoints</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../how-to.html">How-to Guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-to-ext-grant-type.html">How-to: Implement an Extension Authorization Grant Type</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-to-jpa.html">How-to: Implement core services with JPA</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-to-pkce.html">How-to: Authenticate using a Single Page Application with PKCE</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="how-to-social-login.html">How-to: Authenticate using Social Login</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-to-userinfo.html">How-to: Customize the OpenID Connect 1.0 UserInfo response</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
        </nav>
      </div>
    </div>
<ul id="nav-versions" class="nav-versions">
  <li class="component is-current">
    <a class="title" href="../index.html">Spring Authorization Server</a>
    <ul class="versions">
      <li class="version is-current is-latest">
        <a href="../index.html">
          1.2.0-SNAPSHOT<span class="current">current</span>
        </a>
      </li>
    </ul>
  </li>
</ul>
    <div class="resize-handle--x"><span></span></div>
  </aside>
</div><main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<div class="search">
  <button class="DocSearch-Button search-button">
    <svg enable-background="new 0 0 32 32" id="Glyph" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <path d="M27.414,24.586l-5.077-5.077C23.386,17.928,24,16.035,24,14c0-5.514-4.486-10-10-10S4,8.486,4,14  s4.486,10,10,10c2.035,0,3.928-0.614,5.509-1.663l5.077,5.077c0.78,0.781,2.048,0.781,2.828,0  C28.195,26.633,28.195,25.367,27.414,24.586z M7,14c0-3.86,3.14-7,7-7s7,3.14,7,7s-3.14,7-7,7S7,17.86,7,14z" id="XMLID_223_"/>
    </svg>
    Search
    <span class="search-key"></span>
  </button>
</div>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title="How-to: Authenticate using Social Login"
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
      <div class="edit-this-page"><a href="https://github.com/rwinch/spring-authorization-server/edit/antora/docs/modules/ROOT/pages/guides/how-to-social-login.adoc">Edit this Page</a></div>
      </div>
</aside><div class="doc">
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Spring Authorization Server</a></li>
    <li><a href="../how-to.html">How-to Guides</a></li>
    <li><a href="how-to-social-login.html">How-to: Authenticate using Social Login</a></li>
  </ul>
</nav>
<article>
<h1 id="page-title" class="page">How-to: Authenticate using Social Login</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide shows how to configure <a href="../index.html" class="xref page">Spring Authorization Server</a> with a social login provider (such as Google, GitHub, etc.) for <a href="https://docs.spring.io/spring-security/reference/servlet/authentication/index.html">authentication</a>.
The purpose of this guide is to demonstrate how to replace <a href="https://docs.spring.io/spring-security/reference/servlet/authentication/passwords/form.html">Form Login</a> with <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/login/index.html">OAuth 2.0 Login</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Authorization Server is built on <a href="https://docs.spring.io/spring-security/reference/index.html">Spring Security</a> and we will be using Spring Security concepts throughout this guide.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#register-social-login-provider">Register with Social Login Provider</a></p>
</li>
<li>
<p><a href="#configure-oauth2-login">Configure OAuth 2.0 Login</a></p>
</li>
<li>
<p><a href="#advanced-use-cases">Advanced Use Cases</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="register-social-login-provider"><a class="anchor" href="#register-social-login-provider"></a>Register with Social Login Provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started, you will need to set up an application with your chosen social login provider.
Common providers include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developers.google.com/identity/openid-connect/openid-connect#appsetup">Google</a></p>
</li>
<li>
<p><a href="https://github.com/settings/developers">GitHub</a></p>
</li>
<li>
<p><a href="https://developers.facebook.com/apps">Facebook</a></p>
</li>
<li>
<p><a href="https://www.okta.com/developer/signup">Okta</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Follow the steps for your provider until you are asked to specify a Redirect URI.
To set up a Redirect URI, choose a <code>registrationId</code> (such as <code>google</code>, <code>my-client</code> or any other unique identifier you wish) which you will use to configure both Spring Security <strong>and</strong> your provider.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>registrationId</code> is a unique identifier for the <code>ClientRegistration</code> in Spring Security. The default Redirect URI template is <code>{baseUrl}/login/oauth2/code/{registrationId}</code>. See <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-sample-redirect-uri">Setting the Redirect URI</a> in the Spring Security reference for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For example, testing locally on port <code>9000</code> with a <code>registrationId</code> of <code>google</code>, your Redirect URI would be <code><a href="http://localhost:9000/login/oauth2/code/google" class="bare">localhost:9000/login/oauth2/code/google</a></code>. Enter this value as the Redirect URI when setting up the application with your provider.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you&#8217;ve completed the set-up process with your social login provider, you should have obtained credentials (a Client ID and Client Secret).
In addition, you will need to reference the provider&#8217;s documentation and take note of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authorization URI</strong>: The endpoint that is used to initiate the <code>authorization_code</code> flow at the provider.</p>
</li>
<li>
<p><strong>Token URI</strong>: The endpoint that is used to exchange an <code>authorization_code</code> for an <code>access_token</code> and optionally an <code>id_token</code>.</p>
</li>
<li>
<p><strong>JWK Set URI</strong>: The endpoint that is used to obtain keys for verifying the signature of a JWT, which is required when an <code>id_token</code> is available.</p>
</li>
<li>
<p><strong>User Info URI</strong>: The endpoint that is used to obtain user information, which is required when an <code>id_token</code> is not available.</p>
</li>
<li>
<p><strong>User Name Attribute</strong>: The claim in either the <code>id_token</code> or the User Info Response containing the username of the user.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-oauth2-login"><a class="anchor" href="#configure-oauth2-login"></a>Configure OAuth 2.0 Login</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you&#8217;ve <a href="#register-social-login-provider">registered</a> with a social login provider, you can proceed to configuring Spring Security for <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/login/index.html">OAuth 2.0 Login</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configure-oauth2-login-dependency">Add OAuth2 Client Dependency</a></p>
</li>
<li>
<p><a href="#configure-oauth2-login-client-registration">Register a Client</a></p>
</li>
<li>
<p><a href="#configure-oauth2-login-authentication">Configure Authentication</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configure-oauth2-login-dependency"><a class="anchor" href="#configure-oauth2-login-dependency"></a>Add OAuth2 Client Dependency</h3>
<div class="paragraph">
<p>First, add the following dependency:</p>
</div>
<div id="configure-oauth2-login-maven-dependency" class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div id="configure-oauth2-login-gradle-dependency" class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation "org.springframework.boot:spring-boot-starter-oauth2-client"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-oauth2-login-client-registration"><a class="anchor" href="#configure-oauth2-login-client-registration"></a>Register a Client</h3>
<div class="paragraph">
<p>Next, configure the <code>ClientRegistration</code> with the values obtained <a href="#register-social-login-provider">earlier</a>.
Using Okta as an example, configure the following properties:</p>
</div>
<div id="configure-oauth2-login-okta-example" class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">okta:
  base-url: ${OKTA_BASE_URL}

spring:
  security:
    oauth2:
      client:
        registration:
          my-client:
            provider: okta
            client-id: ${OKTA_CLIENT_ID}
            client-secret: ${OKTA_CLIENT_SECRET}
            scope:
              - openid
              - profile
              - email
        provider:
          okta:
            authorization-uri: ${okta.base-url}/oauth2/v1/authorize
            token-uri: ${okta.base-url}/oauth2/v1/token
            user-info-uri: ${okta.base-url}/oauth2/v1/userinfo
            jwk-set-uri: ${okta.base-url}/oauth2/v1/keys
            user-name-attribute: sub</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>registrationId</code> in the above example is <code>my-client</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The above example demonstrates the <strong>recommended</strong> way to set the Provider URL, Client ID and Client Secret using environment variables (<code>OKTA_BASE_URL</code>, <code>OKTA_CLIENT_ID</code> and <code>OKTA_CLIENT_SECRET</code>). See <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config">Externalized Configuration</a> in the Spring Boot reference for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This simple example demonstrates a typical configuration, but some providers will require additional configuration.
For more information about configuring the <code>ClientRegistration</code>, see <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-boot-property-mappings">Spring Boot Property Mappings</a> in the Spring Security reference.</p>
</div>
</div>
<div class="sect2">
<h3 id="configure-oauth2-login-authentication"><a class="anchor" href="#configure-oauth2-login-authentication"></a>Configure Authentication</h3>
<div class="paragraph">
<p>Finally, to configure Spring Authorization Server to use a social login provider for authentication, you can use <code>oauth2Login()</code> instead of <code>formLogin()</code>.
You can also automatically redirect an unauthenticated user to the provider by configuring <code>exceptionHandling()</code> with an <code>AuthenticationEntryPoint</code>.</p>
</div>
<div class="paragraph">
<p>Continuing our <a href="#configure-oauth2-login-okta-example">earlier example</a>, configure Spring Security using a <code>@Configuration</code> as in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Configure OAuth 2.0 Login</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block">/*
 * Copyright 2020-2022 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package sample.socialLogin;

</span><span class="fold-block is-hidden-folded">import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.annotation.Order;
import org.springframework.http.MediaType;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.oauth2.server.authorization.config.annotation.web.configuration.OAuth2AuthorizationServerConfiguration;
import org.springframework.security.oauth2.server.authorization.config.annotation.web.configurers.OAuth2AuthorizationServerConfigurer;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint;
import org.springframework.security.web.util.matcher.MediaTypeRequestMatcher;

</span><span class="fold-block">@Configuration
@EnableWebSecurity
public class SecurityConfig {

	@Bean <i class="conum" data-value="1"></i><b>(1)</b>
	@Order(1)
	public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http)
			throws Exception {
		OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
		http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)
			.oidc(Customizer.withDefaults());	// Enable OpenID Connect 1.0
		http
			// Redirect to the OAuth 2.0 Login endpoint when not authenticated
			// from the authorization endpoint
			.exceptionHandling((exceptions) -&gt; exceptions
				.defaultAuthenticationEntryPointFor( <i class="conum" data-value="2"></i><b>(2)</b>
					new LoginUrlAuthenticationEntryPoint("/oauth2/authorization/my-client"),
					new MediaTypeRequestMatcher(MediaType.TEXT_HTML)
				)
			)
			// Accept access tokens for User Info and/or Client Registration
			.oauth2ResourceServer((oauth2) -&gt; oauth2.jwt(Customizer.withDefaults()));

		return http.build();
	}

	@Bean <i class="conum" data-value="3"></i><b>(3)</b>
	@Order(2)
	public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http)
			throws Exception {
		http
			.authorizeHttpRequests((authorize) -&gt; authorize
				.anyRequest().authenticated()
			)
			// OAuth2 Login handles the redirect to the OAuth 2.0 Login endpoint
			// from the authorization server filter chain
			.oauth2Login(Customizer.withDefaults()); <i class="conum" data-value="4"></i><b>(4)</b>

		return http.build();
	}

}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A Spring Security filter chain for the <a href="../protocol-endpoints.html" class="xref page">Protocol Endpoints</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure an <code>AuthenticationEntryPoint</code> for redirecting to the <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/login/advanced.html#oauth2login-advanced-login-page">OAuth 2.0 Login endpoint</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A Spring Security filter chain for <a href="https://docs.spring.io/spring-security/reference/servlet/authentication/index.html">authentication</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Configure <a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/login/index.html">OAuth 2.0 Login</a> for authentication.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you configured a <code>UserDetailsService</code> when <a href="../getting-started.html#developing-your-first-application" class="xref page">getting started</a>, you can remove it now.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-use-cases"><a class="anchor" href="#advanced-use-cases"></a>Advanced Use Cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/spring-projects/spring-authorization-server/tree/main/samples#demo-sample" target="_blank" rel="noopener">demo authorization server sample</a> demonstrates advanced configuration options for federating identity providers.
Select from the following use cases to see an example of each:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>I want to <a href="#advanced-use-cases-capture-users">Capture Users in a Database</a></p>
</li>
<li>
<p>I want to <a href="#advanced-use-cases-map-claims">Map Claims to an ID Token</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="advanced-use-cases-capture-users"><a class="anchor" href="#advanced-use-cases-capture-users"></a>Capture Users in a Database</h3>
<div class="paragraph">
<p>The following example <code>AuthenticationSuccessHandler</code> uses a custom component to capture users in a local database when they first log in:</p>
</div>
<div class="listingblock">
<div class="title"><code>FederatedIdentityAuthenticationSuccessHandler</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import java.io.IOException;
import java.util.function.Consumer;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import org.springframework.security.core.Authentication;
import org.springframework.security.oauth2.client.authentication.OAuth2AuthenticationToken;
import org.springframework.security.oauth2.core.oidc.user.OidcUser;
import org.springframework.security.oauth2.core.user.OAuth2User;
import org.springframework.security.web.authentication.AuthenticationSuccessHandler;
import org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;
</span><span class="fold-block">public final class FederatedIdentityAuthenticationSuccessHandler implements AuthenticationSuccessHandler {

	private final AuthenticationSuccessHandler delegate = new SavedRequestAwareAuthenticationSuccessHandler();

	private Consumer&lt;OAuth2User&gt; oauth2UserHandler = (user) -&gt; {};

	private Consumer&lt;OidcUser&gt; oidcUserHandler = (user) -&gt; this.oauth2UserHandler.accept(user);

	@Override
	public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {
		if (authentication instanceof OAuth2AuthenticationToken) {
			if (authentication.getPrincipal() instanceof OidcUser) {
				this.oidcUserHandler.accept((OidcUser) authentication.getPrincipal());
			} else if (authentication.getPrincipal() instanceof OAuth2User) {
				this.oauth2UserHandler.accept((OAuth2User) authentication.getPrincipal());
			}
		}

		this.delegate.onAuthenticationSuccess(request, response, authentication);
	}

	public void setOAuth2UserHandler(Consumer&lt;OAuth2User&gt; oauth2UserHandler) {
		this.oauth2UserHandler = oauth2UserHandler;
	}

	public void setOidcUserHandler(Consumer&lt;OidcUser&gt; oidcUserHandler) {
		this.oidcUserHandler = oidcUserHandler;
	}

}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>AuthenticationSuccessHandler</code> above, you can plug in your own <code>Consumer&lt;OAuth2User&gt;</code> that can capture users in a database or other data store for concepts like Federated Account Linking or JIT Account Provisioning.
Here is an example that simply stores users in-memory:</p>
</div>
<div class="listingblock">
<div class="title"><code>UserRepositoryOAuth2UserHandler</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import java.util.function.Consumer;

import org.springframework.security.oauth2.core.user.OAuth2User;
</span><span class="fold-block">public final class UserRepositoryOAuth2UserHandler implements Consumer&lt;OAuth2User&gt; {

	private final UserRepository userRepository = new UserRepository();

	@Override
	public void accept(OAuth2User user) {
		// Capture user in a local data store on first authentication
		if (this.userRepository.findByName(user.getName()) == null) {
			System.out.println("Saving first-time user: name=" + user.getName() + ", claims=" + user.getAttributes() + ", authorities=" + user.getAuthorities());
			this.userRepository.save(user);
		}
	}

	static class UserRepository {

		private final Map&lt;String, OAuth2User&gt; userCache = new ConcurrentHashMap&lt;&gt;();

		public OAuth2User findByName(String name) {
			return this.userCache.get(name);
		}

		public void save(OAuth2User oauth2User) {
			this.userCache.put(oauth2User.getName(), oauth2User);
		}

	}

}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-use-cases-map-claims"><a class="anchor" href="#advanced-use-cases-map-claims"></a>Map Claims to an ID Token</h3>
<div class="paragraph">
<p>The following example <code>OAuth2TokenCustomizer</code> maps a user&#8217;s claims from an authentication provider to the <code>id_token</code> produced by Spring Authorization Server:</p>
</div>
<div class="listingblock">
<div class="title"><code>FederatedIdentityIdTokenCustomizer</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

import org.springframework.security.core.Authentication;
import org.springframework.security.oauth2.core.oidc.IdTokenClaimNames;
import org.springframework.security.oauth2.core.oidc.OidcIdToken;
import org.springframework.security.oauth2.core.oidc.endpoint.OidcParameterNames;
import org.springframework.security.oauth2.core.oidc.user.OidcUser;
import org.springframework.security.oauth2.core.user.OAuth2User;
import org.springframework.security.oauth2.server.authorization.token.JwtEncodingContext;
import org.springframework.security.oauth2.server.authorization.token.OAuth2TokenCustomizer;
</span><span class="fold-block">public final class FederatedIdentityIdTokenCustomizer implements OAuth2TokenCustomizer&lt;JwtEncodingContext&gt; {

	private static final Set&lt;String&gt; ID_TOKEN_CLAIMS = Collections.unmodifiableSet(new HashSet&lt;&gt;(Arrays.asList(
			IdTokenClaimNames.ISS,
			IdTokenClaimNames.SUB,
			IdTokenClaimNames.AUD,
			IdTokenClaimNames.EXP,
			IdTokenClaimNames.IAT,
			IdTokenClaimNames.AUTH_TIME,
			IdTokenClaimNames.NONCE,
			IdTokenClaimNames.ACR,
			IdTokenClaimNames.AMR,
			IdTokenClaimNames.AZP,
			IdTokenClaimNames.AT_HASH,
			IdTokenClaimNames.C_HASH
	)));

	@Override
	public void customize(JwtEncodingContext context) {
		if (OidcParameterNames.ID_TOKEN.equals(context.getTokenType().getValue())) {
			Map&lt;String, Object&gt; thirdPartyClaims = extractClaims(context.getPrincipal());
			context.getClaims().claims(existingClaims -&gt; {
				// Remove conflicting claims set by this authorization server
				existingClaims.keySet().forEach(thirdPartyClaims::remove);

				// Remove standard id_token claims that could cause problems with clients
				ID_TOKEN_CLAIMS.forEach(thirdPartyClaims::remove);

				// Add all other claims directly to id_token
				existingClaims.putAll(thirdPartyClaims);
			});
		}
	}

	private Map&lt;String, Object&gt; extractClaims(Authentication principal) {
		Map&lt;String, Object&gt; claims;
		if (principal.getPrincipal() instanceof OidcUser) {
			OidcUser oidcUser = (OidcUser) principal.getPrincipal();
			OidcIdToken idToken = oidcUser.getIdToken();
			claims = idToken.getClaims();
		} else if (principal.getPrincipal() instanceof OAuth2User) {
			OAuth2User oauth2User = (OAuth2User) principal.getPrincipal();
			claims = oauth2User.getAttributes();
		} else {
			claims = Collections.emptyMap();
		}

		return new HashMap&lt;&gt;(claims);
	}

}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure Spring Authorization Server to use this customizer by publishing it as a <code>@Bean</code> as in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Configure <code>FederatedIdentityIdTokenCustomizer</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public OAuth2TokenCustomizer&lt;JwtEncodingContext&gt; idTokenCustomizer() {
    return new FederatedIdentityIdTokenCustomizer();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="how-to-pkce.html">How-to: Authenticate using a Single Page Application with PKCE</a></span>
  <span class="next"><a href="how-to-userinfo.html">How-to: Customize the OpenID Connect 1.0 UserInfo response</a></span>
</nav>
</article>
</div>  </div>
</main>
</div>
<footer class="footer flex">
    <div id="spring-links flex">
        <img id="springlogo" src="../_/img/spring-logo.svg" alt="Spring">
        <p class="smallest antialiased">© <script>var d = new Date();
        document.write(d.getFullYear());</script> <a href="https://www.vmware.com/">VMware</a>, Inc. or its affiliates. <a href="https://www.vmware.com/help/legal.html">Terms of Use</a> • <a href="https://www.vmware.com/help/privacy.html" rel="noopener noreferrer">Privacy</a> • <a href="https://spring.io/trademarks">Trademark Guidelines</a> <span id="thank-you-mobile">• <a href="https://spring.io/thank-you">Thank you</a></span> • <a href="https://www.vmware.com/help/privacy/california-privacy-rights.html">Your California Privacy Rights</a> • <a class="ot-sdk-show-settings">Cookie Settings</a> <span id="teconsent"></span></p>
        <p class="smallest antialiased has-gray-text">Apache®, Apache Tomcat®, Apache Kafka®, Apache Cassandra&trade;, and Apache Geode&trade; are trademarks or registered trademarks of the Apache Software Foundation in the United States and/or other countries. Java&trade;, Java&trade; SE, Java&trade; EE, and OpenJDK&trade; are trademarks of Oracle and/or its affiliates. Kubernetes® is a registered trademark of the Linux Foundation in the United States and other countries. Linux® is the registered trademark of Linus Torvalds in the United States and other countries. Windows® and Microsoft® Azure are registered trademarks of Microsoft Corporation. “AWS” and “Amazon Web Services” are trademarks or registered trademarks of Amazon.com Inc. or its affiliates. All other trademarks and copyrights are property of their respective owners and are only mentioned for informative purposes. Other names may be trademarks of their respective owners.</p>
    </div>
    <div id="social-icons" class="flex jc-between">
        <a href="https://www.youtube.com/user/SpringSourceDev" title="Youtube"><svg id="youtube-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><circle class="cls-1" cx="20" cy="20" r="20"/><path class="cls-2" d="M30.91,14.53a2.89,2.89,0,0,0-2-2C27.12,12,20,12,20,12s-7.12,0-8.9.47a2.9,2.9,0,0,0-2,2A30.56,30.56,0,0,0,8.63,20a30.44,30.44,0,0,0,.46,5.47,2.89,2.89,0,0,0,2,2C12.9,28,20,28,20,28s7.12,0,8.9-.47a2.87,2.87,0,0,0,2-2A30.56,30.56,0,0,0,31.37,20,28.88,28.88,0,0,0,30.91,14.53ZM17.73,23.41V16.59L23.65,20Z"/></svg></a>
        <a href="https://github.com/spring-projects" title="Github"><svg id="github-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><path class="cls-1" d="M38,0a38,38,0,1,0,38,38A38,38,0,0,0,38,0Z"/></g><path class="cls-2" d="M38,15.59A22.95,22.95,0,0,0,30.71,60.3c1.15.21,1.57-.5,1.57-1.11s0-2,0-3.9c-6.38,1.39-7.73-3.07-7.73-3.07A6.09,6.09,0,0,0,22,48.86c-2.09-1.42.15-1.39.15-1.39a4.81,4.81,0,0,1,3.52,2.36c2,3.5,5.37,2.49,6.67,1.91a4.87,4.87,0,0,1,1.46-3.07c-5.09-.58-10.45-2.55-10.45-11.34a8.84,8.84,0,0,1,2.36-6.15,8.29,8.29,0,0,1,.23-6.07s1.92-.62,6.3,2.35a21.82,21.82,0,0,1,11.49,0c4.38-3,6.3-2.35,6.3-2.35a8.29,8.29,0,0,1,.23,6.07,8.84,8.84,0,0,1,2.36,6.15c0,8.81-5.37,10.75-10.48,11.32a5.46,5.46,0,0,1,1.56,4.25c0,3.07,0,5.54,0,6.29s.42,1.33,1.58,1.1A22.94,22.94,0,0,0,38,15.59Z"/></svg></a>
        <a href="https://twitter.com/springcentral" title="Twitter"><svg id="twitter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><circle class="cls-1" cx="37.97" cy="37.97" r="37.97"/><path id="Twitter-2" data-name="Twitter" class="cls-2" d="M55.2,22.73a15.43,15.43,0,0,1-4.88,1.91,7.56,7.56,0,0,0-5.61-2.49A7.78,7.78,0,0,0,37,30a7.56,7.56,0,0,0,.2,1.79,21.63,21.63,0,0,1-15.84-8.23,8,8,0,0,0,2.37,10.52,7.66,7.66,0,0,1-3.48-1v.09A7.84,7.84,0,0,0,26.45,41a7.54,7.54,0,0,1-2,.28A7.64,7.64,0,0,1,23,41.09a7.71,7.71,0,0,0,7.18,5.47,15.21,15.21,0,0,1-9.55,3.37,15.78,15.78,0,0,1-1.83-.11,21.41,21.41,0,0,0,11.78,3.54c14.13,0,21.86-12,21.86-22.42,0-.34,0-.68,0-1a15.67,15.67,0,0,0,3.83-4.08,14.9,14.9,0,0,1-4.41,1.24A7.8,7.8,0,0,0,55.2,22.73Z"/></svg></a>
    </div>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script async src="../_/js/vendor/asciidoctor-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>

<div class="modal micromodal-slide" id="modal-1" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">
            <main class="modal__content" id="modal-1-content">
                <div id="searchbox"></div>
                <div id="counter"></div>
                <div class="search-by">
                    <a target="_blank" rel="noopener noreferrer" href="https://www.algolia.com/" aria-label="Search by Algolia">
                        <img class="light" width="140" src="../_/img/algolia-light.svg" />
                        <img class="dark" width="140" src="../_/img/algolia-dark.svg" />
                    </a>
                </div>
                <div id="hits"></div>
            </main>
        </div>
    </div>
</div>

<script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.17.0/dist/algoliasearch-lite.umd.js" integrity="sha256-Lf9DrpGmcRip6OQzbcL6lnvNmoZNSKpyQX5pMlwatWE=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.54.1/dist/instantsearch.production.min.js" integrity="sha256-xYsZPDeNjYNTBWLvqD2Lxe98hOxcDgOHyMPfz4tVAbk=" crossorigin="anonymous"></script>
<script async id="search-script" src="../_/js/vendor/search.js" data-app-id="WB1FQYI187" data-api-key="9d489079e5ec46dbb238909fee5c9c29" data-index-name="springsecurity" data-stylesheet="../_/css/vendor/search.css" data-page-version="1.2.0"></script>

  </body>
</html>
